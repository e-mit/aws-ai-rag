<!DOCTYPE html>
<html>

<head>
    <title>Captcha JS API</title>
    <script type="text/javascript" src="https://ae19887525f8.eu-west-3.captcha-sdk.awswaf.com/ae19887525f8/jsapi.js" defer></script>
</head>

<body>
    <button id="render-captcha-btn" onClick="onClickRenderCaptcha()">Render Captcha</button>
    <div id="captcha-container"></div>
    <button id="fetch-data-btn" style="display: none" onClick="fetchProtectedData()">Fetch data</button>
    <div id="pets-container"></div>
    <div id="error-container"></div>

    <script>
        /* This is a captcha example provided by AWS; have set up in AWS console as follows:
        1. Create a "new style" AWS WAF web ACL
        - Add a regular rule which matches a specific URI path string (e.g. "/v1/api/version")
        - Choose "captcha" as the action, and select immunity time
        - Allow all requests not matching a rule (ie. all other paths)
        - Associate it with the API Gateway instance
        - disable all logging etc
        2. Under "application integration":
        - copy the captcha integration JS tag, and put it in the page head
        - generate an apiKey for the relevant domain, and paste into the JS code below
        NB: can also do a direct GET to the protected endpoint: it returns a 405 code and
        provides an amazon captcha page, which redirects to the endpoint if solved correctly.
        */
        function setError(error) {
            document.getElementById("error-container").innerHTML = error.message;
        }

        function onClickRenderCaptcha() {
            const container = document.getElementById('captcha-container');
            AwsWafCaptcha.renderCaptcha(container, {
                apiKey: "B4025inDbNz9TWAjMtzvvlRNhEXWKAaBXsr92hKugYKJ/Efd/hqdEFbgaWsNOAgQR+kBDj5N6yQYANjvWHsLr5Y/y75o4ZyfNhex/25NkXjDV55jmRCq/OV/XCAdZnbdrjN/yE7R6D65Abbkha3kCsCWpvRf4yVXjWWeF883XB3gZHho3h/9fhW2/MTM6E4z1y3cHsYSVWSzP8syM6byh9wctMXNTcjApUV6Qx0xqMi0o3g52lBaEs0384ENsCbHD4vie0ONwBlqcjgzwY3GVOdh/lpDVudOdlIEGC4GOan5BbgkjKYGuL7elMQvzqz17pbvFjfos/FFiFi65pbGO7+xZ5LK5OQqIgu5HGDIWyUON3SN11rc5YQsubeTmnswgIwX8BT+U5gn2xUCu+72K9IcXojvmabrBPOH1Muj73DaKoit85rXHoIFyaAYQCzVS4FAHq4GiYhwg129+4Rp5kfB1eOctoH6sO17MWQrZ8sxLsS/66KhzgPByHQ4qf5X9vbaqVWD5x97l9P+WxPkJOE2ZtNZcc42a4aLnVKsIkhQ4ZC/4gEUa0988CZ8WRh+LnBRfPmxiZgU+PgxqnG0ge7GP5IMdViyBUF8tUYaDZD3ADtP7oH/mIuRvCRtBC78f228py8DGaYEceN7A+Up5XmU4e7rERIIoo4uLy+JiS8=_0_1",
                onSuccess: () => {
                    document.getElementById("fetch-data-btn").style.display = 'block';
                },
                onError: setError,
            });
        }

        function fetchProtectedData() {
            AwsWafIntegration.fetch('../api/version', {
                method: 'GET'
            })
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById('pets-container').textContent = JSON.stringify(data);
                })
                .catch(setError);
        }
    </script>
</body>

</html>